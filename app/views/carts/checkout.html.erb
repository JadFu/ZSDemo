<!-- app/views/carts/checkout.html.erb -->
<h1>Checkout</h1>

    <div class="cart-items">
        <table>
            <thead>
            <tr>
                <th>Item Name</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total</th>
            </tr>
            </thead>
            <tbody>
            <% @cart_items.each do |item_id, quantity| %>
                <% item = Item.find(item_id) %>
                <tr>
                <td><%= link_to item.name, item_path(item) %></td>
                <td><%= quantity %></td>
                <td><%= number_to_currency(item.price) %></td>
                <td><%= number_to_currency(item.price * quantity) %></td>
                </tr>
            <% end %>
            </tbody>
        </table>

        <p>Total Price: <%= number_to_currency(@cart_items.sum { |item_id, quantity| Item.find(item_id).price * quantity }) %></p>

        </div>
        
        <div class="user-info">
          <%= form_with(model: @user, url: confirm_checkout_path) do |form| %>
            <%= form.label :email %>
            <%= form.email_field :email, required: true %>

            <%= form.label :address %>
            <%= form.text_area :address, required: true %>

            <%= label_tag :tax_id, 'Tax Region' %>
            <%= select_tag 'user[tax_id]', options_for_select(Tax.pluck(:tax_region, :id)), required: true %>

            <%= form.submit 'Confirm Checkout' %>
        <% end %>
        </div>