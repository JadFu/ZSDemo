<!-- app/views/carts/confirm_checkout.html.erb -->
<h1>Confirm Checkout</h1>

<h2>Items in Checkout List</h2>
<table>
  <thead>
    <tr>
      <th>Item Name</th>
      <th>Quantity</th>
      <th>Individual Item Price</th>
      <th>Total Price Before Tax</th>
    </tr>
  </thead>
  <tbody>
    <% @cart_items.each do |item_id, quantity| %>
      <% item = Item.find(item_id) %>
      <tr>
        <td><%= item.name %></td>
        <td><%= quantity %></td>
        <td><%= number_to_currency(item.price) %></td>
        <td><%= number_to_currency(item.price * quantity) %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<h2>Checkout Information</h2>
<p><strong>Email:</strong> <%= @user.email %></p>
<p><strong>Address:</strong> <%= @user.address %></p>
<p><strong>Tax Region:</strong> <%= @tax.tax_region %></p>

<h2>Order Summary</h2>
<p>Total Price Before Tax: <%= number_to_currency(@total_price_before_tax) %></p>
<p>GST Amount: <%= number_to_currency(@total_gst) %></p>
<p>PST Amount: <%= number_to_currency(@total_pst) %></p>
<p>HST Amount: <%= number_to_currency(@total_hst) %></p>
<p>Total Price After Tax: <%= number_to_currency(@total_price_after_tax) %></p>

<%= link_to 'Proceed to Payment', '#', id: 'paypal-button', class: 'btn btn-primary' %>
<script src="https://www.paypal.com/sdk/js?client-id=<%= ENV['PAYPAL_CLIENT_ID'] %>"></script>
<script>
  paypal.Buttons({
    createOrder: function(data, actions) {
      return actions.order.create({
        purchase_units: [{
          amount: {
            value: '<%= @total_price_after_tax %>' // Use the total price after tax
          }
        }]
      });
    },
    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
        // Handle successful payment, e.g., show a success message
        alert('Payment completed successfully!');
        // You can also make an AJAX request to your server to update the order status, etc.
      });
    }
  }).render('#paypal-button');
</script>

<%= link_to 'Back to Cart', cart_path, class: 'btn btn-secondary' %>
